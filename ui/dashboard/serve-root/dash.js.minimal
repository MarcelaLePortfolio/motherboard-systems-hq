/* eslint-disable import/no-commonjs */
// ğŸ› ï¸ DEBUG AGENT STATUS FETCH + DOM MATCH
fetch("./agent-status.json")
  .then((res) => res.json())
  .then((statusMap) => {
    console.log("ğŸ“¦ Loaded agent-status.json:", statusMap);

    const agentColorMap = {
      online: "green",
      stopped: "gray",
      errored: "red",
      unknown: "goldenrod"
    };

    const agents = {
      matilda: "ğŸ§  Matilda",
      cade: "ğŸ› ï¸ Cade",
      effie: "ğŸ–¥ Effie"
    };

    document.querySelectorAll(".agent").forEach((el, i) => {
      const label = el.textContent.trim();
      console.log(`ğŸ” Agent[${i}]:`, label);

      for (const [key, expectedLabel] of Object.entries(agents)) {
        if (label.includes(expectedLabel)) {
          const span = el.querySelector("span");
          const status = statusMap[key] || "unknown";
          const color = agentColorMap[status] || "goldenrod";
          if (span) {
            span.style.backgroundColor = color;
            el.title = `${expectedLabel} â€“ ${status}`;
            console.log(`âœ… ${expectedLabel} â†’ ${status} â†’ ${color}`);
          } else {
            console.warn(`âš ï¸ No span found for ${expectedLabel}`);
          }
        }
      }
    });
  })
  .catch((err) => {
    console.error("âŒ Failed to fetch or paint agent statuses:", err);
  });
