services:
  worker:
    build:
      context: .
    command: ["node", "server/worker/phase26_task_worker.mjs"]
    environment:
      # In-compose networking: use the service name "postgres"
      POSTGRES_URL: postgres://postgres:postgres@postgres:5432/postgres

      WORKER_MAX_CLAIMS: ${WORKER_MAX_CLAIMS:-1}
      WORKER_MAX_ATTEMPTS: ${WORKER_MAX_ATTEMPTS:-3}
      WORKER_BACKOFF_BASE_MS: ${WORKER_BACKOFF_BASE_MS:-2000}
      WORKER_BACKOFF_MAX_MS: ${WORKER_BACKOFF_MAX_MS:-60000}

      PHASE27_CLAIM_ONE_SQL: ${PHASE27_CLAIM_ONE_SQL:-server/worker/phase28_claim_one.sql}
      PHASE27_MARK_SUCCESS_SQL: ${PHASE27_MARK_SUCCESS_SQL:-server/worker/phase28_mark_success.sql}
      PHASE27_MARK_FAILURE_SQL: ${PHASE27_MARK_FAILURE_SQL:-server/worker/phase28_mark_failure.sql}

      PHASE26_TICK_MS: ${PHASE26_TICK_MS:-500}
      PHASE26_WORKER_ACTOR: ${PHASE26_WORKER_ACTOR:-phase26.worker}
    depends_on:
      - postgres
    restart: unless-stopped
