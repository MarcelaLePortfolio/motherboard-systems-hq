FROM node:20-alpine

WORKDIR /app

# Build metadata (optional; passed by docker compose build args if present)
ARG GIT_SHA="unknown"
ARG BUILD_TIME="unknown"
ENV GIT_SHA=$GIT_SHA
ENV BUILD_TIME=$BUILD_TIME

COPY package*.json ./
COPY package-lock.json* ./
RUN npm ci --no-audit --no-fund && apk add --no-cache curl ripgrep

COPY . .

EXPOSE 3000
COPY public/ ./public/
CMD ["node", "server.mjs"]
