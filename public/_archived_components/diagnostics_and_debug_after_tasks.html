

<details id="diagnosticsSection" open style="margin:1rem 0;border:1px solid #ddd;border-radius:10px;padding:0.6rem;background:#fafafa;">
</details>
    });

    // Chat Logic
    const chatLog = document.getElementById("chatLog");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;
      appendMessage("You", message);
      userInput.value = "";

      try {
        const res = await fetch("/delegate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });
        const data = await res.json();
        appendMessage("Matilda", data.reply || data.reply || "(no response)");
      } catch (err) {
        appendMessage("Matilda", "‚ùå Connection error.");
        console.error("Chat send error:", err);
      }
    }

    function appendMessage(sender, text) {
      const msg = document.createElement("div");
      msg.innerHTML = `<b>${sender}:</b> ${text}`;
      chatLog.appendChild(msg);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

  </script>


  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

<script defer src="dashboard.js"></script>
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

<script src="dashboard-status.js?v=1761345479?v=1761342950?v=1761340126?v=1761340061?v=1761339985?v=1761339943?v=1761339524?v=1761338898"></script>
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

<script src="js/dashboard-ops.js"></script>


  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

<script src="dashboard-stream.js" defer></script>
  <style id="dark-patch-override">
    :root{color-scheme:dark}
    html,body{background:#111 !important;color:#fff !important}
    #app, .container, .wrapper{background:#111 !important;color:#fff !important}
    /* Panels */
    .panel, .card, .box, .module{background:#1a1a1a !important;color:#f5f5f5 !important;border-color:#333 !important}
    /* Chat */
    #chatFeed, .chat-feed{background:#121212 !important;color:#f0f0f0 !important}
    .chat-message.user{background:#1e1e1e !important;color:#fff !important;border-color:#333 !important}
    .chat-message.bot{background:#161616 !important;color:#eaeaea !important;border-color:#2a2a2a !important}
    #userInput, input[type=text], textarea{background:#171717 !important;color:#fff !important;border:1px solid #333 !important}
    #sendButton, #delegateButton, .action-button{background:#222 !important;color:#fff !important;border:1px solid #3a3a3a !important}
    /* Tables */
    table{background:#141414 !important;color:#f0f0f0 !important}
    th,td{border-color:#333 !important}
    /* Links */
    a{color:#9ecbff !important}
  </style>
<style id="chatlog-darkfix">
  #chatLog {
  .chat-message { display: inline-block; width: fit-content; max-width: 75%; margin: 10px 0; padding: 10px 14px; border-radius: 10px; line-height: 1.5; clear: both; word-wrap: break-word; }
  .chat-message.user { background: #0047ff; color: #fff; margin-left: auto; margin-right: 0; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(0,71,255,0.4); float: right; clear: both; }
  .chat-message.bot { background: #04693a; color: #fff; margin-left: 0; margin-right: auto; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(4,105,58,0.4); float: left; clear: both; }
  #chatLog { display: block; padding: 10px; }
  #chatLog::after { content: ""; display: block; clear: both; }
  .chat-message { display: block; width: fit-content; max-width: 80%; margin: 10px 0; padding: 10px 14px; border-radius: 10px; line-height: 1.5; clear: both; }
  .chat-message.user { background: #0047ff; color: #fff; margin-left: auto; margin-right: 0; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(0,71,255,0.4); }
  .chat-message.bot { background: #04693a; color: #fff; margin-left: 0; margin-right: auto; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(4,105,58,0.4); }
  #chatLog { display: flex; flex-direction: column; gap: 6px; align-items: flex-start; }
  .chat-message { display: inline-block; width: fit-content; max-width: 75%; margin: 10px 0; padding: 10px 14px; border-radius: 10px; line-height: 1.5; clear: both; word-wrap: break-word; }
  .chat-message.user { background: #0047ff; color: #fff; margin-left: auto; margin-right: 0; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(0,71,255,0.4); float: right; clear: both; }
  .chat-message.bot { background: #04693a; color: #fff; margin-left: 0; margin-right: auto; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 6px rgba(4,105,58,0.4); float: left; clear: both; }
  #chatLog { display: block; padding: 10px; }
  #chatLog::after { content: ""; display: block; clear: both; }
  #chatLog::after { content: ""; display: block; clear: both; }
  .chat-message { display: block; clear: both; margin: 8px 0; padding: 10px 14px; border-radius: 10px; line-height: 1.4; }
  .chat-message.user { background: #0047ff; color: #fff; float: right; text-align: right; }
  .chat-message.bot { background: #04693a; color: #fff; float: left; text-align: left; }
  #chatLog::after { content: ""; display: block; clear: both; }
    background-color: #0b0b0b !important;
    color: #ffffff !important;
    -webkit-text-fill-color: #ffffff !important;
    border: 1px solid #1f2937 !important;
    border-radius: 8px !important;
    padding: 12px !important;
    overflow-y: auto !important;
    max-height: 40vh !important;
  }
  #chatLog .chat-message {
    background-color: #111827 !important;
    color: #ffffff !important;
    border: 1px solid #374151 !important;
    border-radius: 8px !important;
    padding: 8px 10px !important;
    margin: 6px 0 !important;
    line-height: 1.4 !important;
    display: inline-block !important;
    max-width: 90% !important;
    word-wrap: break-word !important;
    white-space: pre-wrap !important;
  }
  #chatLog .chat-message.user {
    background-color: #1e3a8a !important;
    border-color: #3b82f6 !important;
  }
  #chatLog .chat-message.matilda {
    background-color: #065f46 !important;
    border-color: #10b981 !important;
  }
  #chatLog .chat-message.system {
    background-color: #3f3f46 !important;
    color: #e5e7eb !important;
    font-style: italic !important;
  }
</style>
<link rel="stylesheet" href="css/dashboard-reflections.css">
</head>
</html>
<script>
  async function sendMessage() {
    const input = document.getElementById("userInput");
    const log = document.getElementById("chatLog");
    const message = input.value.trim();
    if (!message) return;
    log.innerHTML += `<div><b>You:</b> ${message}</div>`;
    try {
      const res = await fetch("/delegate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      log.innerHTML += `<div style="color:green;"><b>Matilda:</b> ${data.reply}</div>`;
    }
      catch (err) {
        console.error("Matilda fetch failed:", err);
        log.innerHTML += `<div style="color:red;"><b>Error:</b> Unable to reach Matilda</div>`;
      }
  }
  document.getElementById("userInput").addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

</script>
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});

  <script src="js/dashboard-reflections.js"></script>
<script>
  const input = document.getElementById("userInput").value.trim();
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});
</script>
<script>
  const input = document.getElementById("userInput").value.trim();
  if (!input) return;
  try {
    const res = await fetch("/delegate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instruction: input })
    });
    const data = await res.json();
    console.log("üöÄ Delegation result:", data);
  } catch (err) {
    console.error("Delegation failed:", err);
  }
});
</script>
<script>
const delegateButton = document.getElementById("delegateButton");
const userInput = document.getElementById("userInput");

if (delegateButton && userInput) {
  delegateButton.addEventListener("click", async () => {
    const instruction = userInput.value.trim();
    if (!instruction) return alert("Please enter a command first!");

    try {
      const res = await fetch("/delegate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ instruction }),
      });
      const data = await res.json();
      if (data.ok) {
        console.log("üöÄ Delegation succeeded:", data);
        alert("Delegation succeeded! üéâ");
      } else {
        console.error("Delegation failed:", data);
        alert("Delegation failed. Check the terminal logs for details.");
      }
    } catch (err) {
      console.error("Delegation error:", err);
      alert("Delegation failed ‚Äî see console for details.");
    }
  });
  console.warn("üöÄ Delegation button or input not found.");
}
</script>
<link rel="stylesheet" href="styles/agent-status-row.css">
<script src="scripts/agent-status-row.js"></script>
<script src="scripts/matilda-chat.js"></script>
</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("delegateBtn");
  if (!btn) return;
  btn.addEventListener("click", async () => {
    const input = document.getElementById("userInput").value.trim();
    if (!input) return;
    try {
      const res = await fetch("/delegate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ instruction: input })
      });
      const data = await res.json();
      console.log("üöÄ Delegation result:", data);
    } catch (err) {
      console.error("Delegation failed:", err);
    }
  });
});
</script>
<script>
(function () {
  const btn = document.getElementById("delegateButton");
  const input = document.getElementById("userInput");

  if (!btn || !input) {
    console.warn("üöÄ Delegate wiring: missing button or input", {
      btn: !!btn,
      input: !!input,
    });
      }

      if (res.ok && data && data.ok) {
        console.log("ÔøΩÔøΩ Delegation succeeded:", data);
        alert("Delegation succeeded! üéâ");
      } else {
        console.error("Delegation failed payload:", data);
        alert("Delegation failed. Check console/logs.");
      }
    } catch (err) {
      console.error("Delegation network error:", err);
      alert("Delegation failed ‚Äî see console for details.");
    }
  });
})();
</script>
<script>
(function () {
  const btn = document.getElementById("delegateButton");
  const input = document.getElementById("userInput");
  if (!btn || !input) return console.warn("üöÄ Delegate wiring: missing button or input");
  console.log("üöÄ Delegate wiring: ready");

  btn.addEventListener("click", async () => {
    const instruction = input.value.trim();
    if (!instruction) return alert("Please enter a command first!");
    try {
      const res = await fetch("/delegate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ instruction }),
      });
      const data = await res.json();
      if (res.ok && data.ok) {
        console.log("üöÄ Delegation succeeded:", data);
        alert("Delegation succeeded! üéâ");
      } else {
        console.error("Delegation failed payload:", data);
        alert("Delegation failed. Check console/logs.");
      }
    } catch (err) {
      console.error("Delegation network error:", err);
      alert("Delegation failed ‚Äî see console for details.");
    }
  });
})();
</script>
<style id="chat-styling-fix">
  /* <0001fc40> Phase 10.3 ‚Äî Proper stacked chat layout (user above, Matilda below) */
  #chatLog {
    display: block;
    padding: 12px;
    overflow-y: auto;
  }

  .chat-message {
    display: inline-block;
    max-width: 75%;
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 10px;
    line-height: 1.5;
    word-wrap: break-word;
    clear: both;
  }

  .chat-message.user {
    background: #0047ff;
    color: #fff;
    float: right;
    text-align: right;
    clear: both;
    margin-left: auto;
    margin-right: 0;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 0 6px rgba(0,71,255,0.4);
  }

  .chat-message.bot {
    background: #04693a;
    color: #fff;
    float: left;
    text-align: left;
    clear: both;
    margin-left: 0;
    margin-right: auto;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 0 6px rgba(4,105,58,0.4);
  }

  #chatLog::after {
    content: "";
    display: block;
    clear: both;
  }
</style>
<style id="chat-styling-override">
  /* <0001fc45> Phase 10.3.1 ‚Äî Forced stacked chat layout override */
  #chatLog {
    display: block !important;
    padding: 12px !important;
  }

  .chat-message {
    display: block !important;
    width: fit-content !important;
    max-width: 75% !important;
    margin: 10px 0 !important;
    padding: 10px 14px !important;
    border-radius: 10px !important;
    line-height: 1.5 !important;
    clear: both !important;
    word-wrap: break-word !important;
  }

  .chat-message.user {
    background: #0047ff !important;
    color: #fff !important;
    float: right !important;
    text-align: right !important;
    margin-left: auto !important;
    margin-right: 0 !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    box-shadow: 0 0 6px rgba(0,71,255,0.4) !important;
  }

  .chat-message.bot {
    background: #04693a !important;
    color: #fff !important;
    float: left !important;
    text-align: left !important;
    margin-left: 0 !important;
    margin-right: auto !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    box-shadow: 0 0 6px rgba(4,105,58,0.4) !important;
  }

  #chatLog::after {
    content: "" !important;
    display: block !important;
    clear: both !important;
  }
</style>
