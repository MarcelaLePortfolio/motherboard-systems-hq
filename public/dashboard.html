  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!DOCTYPE html><html lang="en"><head>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <meta charset="UTF-8">

  <title>üñ•Ô∏è Motherboard Systems</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h1 { color: #333; }

    .card { background: #fff; padding: 15px; margin-bottom: 20px;
            border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    /* Chat styles */
    .chat-window { height: 250px; overflow-y: auto; padding: 10px; border: 1px solid #ddd;
                   border-radius: 6px; background: #fafafa; margin-bottom: 10px; }
    .chat-message { margin: 5px 0; max-width: 70%; padding: 8px 12px;
                    border-radius: 12px; word-wrap: break-word; }
    .chat-user { background: #d1e7ff; margin-left: auto; text-align: right; }
    .chat-matilda { background: #f1f1f1; margin-right: auto; text-align: left; }
    .chat-time { font-size: 0.75em; color: #666; margin-top: 2px; }
    .chat-input { display: flex; gap: 8px; }
    .chat-input input { flex: 1; padding: 8px; }
    .chat-input button { padding: 8px 12px; }

    .chat-message pre {
      max-height: 150px; overflow-y: auto; white-space: pre-wrap;
      background: #f4f4f4; padding: 6px; border-radius: 6px; margin-top: 4px;
    }

    /* --- Polishing styles --- */
    .card{background:#fff;padding:16px;margin:16px 0;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.08);}
    #agents,#tasks,#logs{width:100%;border-collapse:collapse;}
    #agents th,#agents td,#tasks th,#tasks td,#logs th,#logs td{border:1px solid #eee;padding:8px 10px;text-align:left;}
    #agents tr:nth-child(even),#tasks tr:nth-child(even),#logs tr:nth-child(even){background:#fafafa;}
    #agents:empty::before,#tasks:empty::before,#logs:empty::before{content:"No data";display:block;color:#777;padding:8px 0;}
    .status-online{color:#2e7d32;font-weight:600;}
    .status-offline{color:#c62828;font-weight:600;}
    .status-idle{color:#8d6e63;font-weight:600;}
    .badge{padding:2px 6px;border-radius:6px;font-size:.8em;font-weight:600;display:inline-block;}
    .badge-online{background:#e5f5e0;color:#2e7d32;}
    .badge-offline{background:#ffebee;color:#c62828;}
    .badge-idle{background:#fff8e1;color:#8d6e63;}
    .timestamp{font-size:.8em;color:#666;}
    .task-item,.log-item{margin-bottom:8px;padding:6px 8px;border-bottom:1px solid #eee;}
  </style>
</head>
<body>
  <h1>üñ•Ô∏è Motherboard Systems</h1>

  <div id="debugBanner" style="background:#e6f7ff; border:1px solid #91d5ff; padding:8px; margin:10px 0; border-radius:6px; color:#0050b3; font-size:0.9em;">
    ‚ö° Dashboard v2.0.1 loaded ‚Äî waiting for scripts‚Ä¶
  </div>

    
  

  <!-- Agent Status -->
  <header style="display:flex; gap:1rem; align-items:center; flex-wrap:wrap;">
    <h2>üìü Agent Status</h2>
    <ul>
      <li>Matilda: üü¢ Idle</li>
      <li>Cade: üü† Busy</li>
      <li>Effie: üü¢ Idle</li>
    </ul>
  </header><div class="card">
    <h2>üí¨ Chat with Assistant</h2>
  <div id="chatLog" style="height:200px; overflow-y:auto; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; padding:1rem; margin-bottom:1rem;"></div>
  <div class="chat-input" style="background:#fff0f0;border:2px solid red;padding:1rem;margin-top:1rem;display:flex;gap:0.5rem;">
    <input type="text" id="userInput" placeholder="Type a message..." style="flex:1;padding:0.5rem;font-size:1rem;border:1px solid blue;">
    <button onclick="sendMessage()" style="padding:0.5rem 1rem;font-size:1rem;background:#ff0;">Send</button>
  </div>
<h2>Recent Tasks</h2>
    <table id="tasks"></table>
  </div>

  <!-- Recent Logs -->
  <div class="card">
    <h2>Recent Logs</h2>
    <table id="logs"></table>
  </div>

  <script src="/dashboard.js?v=1.2.0" defer=""></script>



  <!-- === Core Diagnostic Panels === -->
  <section id="system-health" style="margin:1rem;padding:1rem;background:#fff;border-radius:8px;box-shadow:0 0 5px #ccc;">
    <h3>‚öôÔ∏è System Health & Verification</h3>
    <pre id="system-health-content">Loading...</pre>
  </section>

  <section id="matilda-insights" style="margin:1rem;padding:1rem;background:#fff;border-radius:8px;box-shadow:0 0 5px #ccc;">
    <h3>üß† Matilda Insights</h3>
    <pre id="persistent-insight">Loading insights...</pre>
  </section>


  <section id="autonomic-adaptation" style="margin:1rem;padding:1rem;background:#fff;border-radius:8px;box-shadow:0 0 5px #ccc;">
    <h3>ü§ñ Autonomic Adaptation</h3>
    <pre id="autonomic-adaptation-content">Awaiting data...</pre>
  </section>

  <!-- === Collapsible Deep Diagnostics === -->
  <details style="margin:1rem;padding:1rem;background:#fafafa;border-radius:8px;box-shadow:inset 0 0 4px #ddd;">
    <summary style="cursor:pointer;font-weight:bold;">üîÆ Introspective Simulation</summary>
    <pre id="introspective-sim">Simulation logs will appear here...</pre>
  </details>

  <details style="margin:1rem;padding:1rem;background:#fafafa;border-radius:8px;box-shadow:inset 0 0 4px #ddd;">
    <summary style="cursor:pointer;font-weight:bold;">üìú System Chronicle</summary>
    <pre id="system-chronicle">Chronicle data will appear here...</pre>
  </details>
  <script>
    async function updatePanel(id, endpoint) {
      const el = document.getElementById(id);
      if (!el) { console.warn("Panel #" + id + " not found"); return; }
      try {
        console.log("Fetching " + endpoint + " for " + id + "...");
        const res = await fetch(endpoint);
        if (!res.ok) throw new Error(res.status + " " + res.statusText);
        const data = await res.json();
        el.textContent = JSON.stringify(data, null, 2);
        console.log("Updated " + id + " at " + new Date().toLocaleTimeString());
      } catch (err) {
        console.error("Panel " + id + " failed:", err.message);
        el.textContent = "Endpoint unavailable: " + endpoint;
      }
    }

    async function refreshAllDiagnostics() {
      console.log("Refresh cycle started at " + new Date().toLocaleTimeString());
      await updatePanel("system-health-content", "/system/health");
      await updatePanel("persistent-insight", "/insight/persist");
      await updatePanel("autonomic-adaptation-content", "/adaptation/history");
      await updatePanel("introspective-sim", "/introspect/history");
      await updatePanel("system-chronicle", "/chronicle/list");
      await updatePanel("insight-visualizer", "/visual/trends");
      console.log("Refresh cycle complete.");
    }

    window.addEventListener("load", () => {
      console.log("Diagnostic Auto-Refresh engaged");
      refreshAllDiagnostics();
      setInterval(refreshAllDiagnostics, 15000);
    });
  </script>
</body>
</html>
  <script>
    // ‚úÖ Clean full restoration script
    async function refreshTasks() {
      try {
        const res = await fetch("/tasks/recent");
        const data = await res.json();
        const el = document.getElementById("tasks");
        if (!el) return console.warn("‚ö†Ô∏è #tasks not found");
        el.innerHTML = `<tr><th>Task</th><th>Status</th><th>Time</th></tr>` +
          data.map(t => `<tr><td>${t.task}</td><td>${t.status}</td><td>${new Date(t.timestamp).toLocaleTimeString()}</td></tr>`).join('');
      } catch (err) {
        console.error("‚ùå Failed to fetch tasks", err);
      }
    }

    async function refreshLogs() {
      try {
        const res = await fetch("/logs/recent");
        const data = await res.json();
        const el = document.getElementById("logs");
        if (!el) return console.warn("‚ö†Ô∏è #logs not found");
        el.innerHTML = `<tr><th>Message</th><th>Level</th><th>Time</th></tr>` +
          data.map(l => `<tr><td>${l.message}</td><td>${l.level}</td><td>${new Date(l.timestamp).toLocaleTimeString()}</td></tr>`).join('');
      } catch (err) {
        console.error("‚ùå Failed to fetch logs", err);
      }
    }

    async function waitForChart() {
      try {
        const res = await fetch("/visual/trends");
        const data = await res.json();
        const el = document.getElementById("insight-visualizer");
        if (!el) return console.warn("‚ö†Ô∏è #insight-visualizer not found in DOM");
        el.innerHTML = `<canvas id='insightChart' height='120'></canvas>`;
        const ctx = document.getElementById("insightChart").getContext("2d");
        const labels = data.map(d => `T${d.t}`);
        new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [
              { label: "Success %", data: data.map(d => d.success), borderColor: "green", tension: 0.3 },
              { label: "Risk %", data: data.map(d => d.risk), borderColor: "red", tension: 0.3 }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" },
              title: { display: true, text: "System Insight Trends" }
            },
            scales: { y: { beginAtZero: true, max: 100 } }
          }
        });
        console.log("‚úÖ Chart.js ready and chart drawn!");
      } catch (err) {
        console.error("‚ùå Failed to draw chart:", err);
      }
    }

    window.addEventListener("load", () => {
      console.log("üì° Dashboard diagnostics auto-refresh engaged");
      refreshTasks();
      refreshLogs();
      waitForChart();
      setInterval(() => {
        refreshTasks();
        refreshLogs();
        waitForChart();
      }, 10000);
    });
  </script>
</body>
</html>
<script>
  async function sendMessage() {
    const input = document.getElementById("userInput");
    const log = document.getElementById("chatLog");
    const message = input.value.trim();
    if (!message) return;
    log.innerHTML += `<div><b>You:</b> ${message}</div>`;
    try {
      const res = await fetch("/matilda", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      log.innerHTML += `<div style="color:green;"><b>Matilda:</b> ${data.message}</div>`;
      log.scrollTop = log.scrollHeight;
      input.value = "";
    } catch (err) {
      log.innerHTML += `<div style="color:red;"><b>Error:</b> ${err.message}</div>`;
      console.error("‚ùå Chat send error:", err);
    }
  }
  document.getElementById("userInput").addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });
</script>
